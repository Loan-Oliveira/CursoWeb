USE [ics]
GO

/****** Object:  StoredProcedure [dbo].[SP_WEB_MAIS_VANT_CAT]    Script Date: 27/03/2024 11:14:14 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[SP_WEB_MAIS_VANT_CAT]
   @NR_ID INT = 0,
   @NOME VARCHAR(100) = NULL,
   @TP_OP INT = 0
AS BEGIN
	
	/**** BUSCA ****/
	IF @TP_OP = 0
	BEGIN
		SELECT T836_NR_ID, T836_CA_NOME FROM T836_MAIS_VANT_CAT T836
		WHERE (1=1)
		AND ( (@NR_ID = 0) OR 
	      (T836.T836_NR_ID = @NR_ID ) ) 
	END

	/**** INCLUSÃO ****/
	IF @TP_OP = 1
	BEGIN
		IF @NOME = ''
		BEGIN
			SELECT 1 AS 'CODERRO', 'NOME/DESCRIÇÃO DA CATEGORIA NÃO INFORMADA' AS 'MSGERRO'
			RETURN
		END
		ELSE
		BEGIN	
			INSERT INTO T836_MAIS_VANT_CAT (T836_CA_NOME) VALUES(@NOME)
		END
	END

	/**** EXCLUSÃO ****/
	IF @TP_OP = 2
	BEGIN
		IF (SELECT T836_NR_ID FROM T836_MAIS_VANT_CAT WHERE T836_NR_ID  = @NR_ID) IS NULL
		BEGIN
			SELECT 2 AS 'CODERRO', 'CATEGORIA NÃO ENCONTRADA' AS 'MSGERRO'
			RETURN
		END

		ELSE
		BEGIN
			DELETE FROM T836_MAIS_VANT_CAT WHERE T836_NR_ID = @NR_ID

			UPDATE T837_MAIS_VANT_PARC SET T836_NR_ID = NULL WHERE T836_NR_ID = @NR_ID 
		END
	END

	/**** ALTERACÃO ****/
	IF @TP_OP = 3
	BEGIN
		IF @NOME = ''
		BEGIN
			SELECT 1 AS 'CODERRO', 'NOME/DESCRIÇÃO DA CATEGORIA NÃO INFORMADA' AS 'MSGERRO'
			RETURN
		END
		ELSE
		BEGIN
			UPDATE T837_MAIS_VANT_VAT SET T836_CA_NOME = @NOME WHERE T836_NR_ID = @NR_ID 
		END
	END

END


GO


